<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="ateam.mapper.AdminClassroomMapper">
	
	<select id="SelectAdminClassroom" resultType="java.util.Map">
		SELECT CLASSROOM_ID, CLASSROOM_NAME, MAX_PEOPLE
		FROM CLASSROOM;
	</select>
	
	<select id="SelectAdminclassyear" resultType="java.util.Map">
		SELECT DISTINCT YEAR(CLASS_START) as YEAR, CONCAT(YEAR(CLASS_START), "년") AS YEARN
		FROM CLASS
		ORDER BY YEAR DESC;
	</select>
	
	<select id="SelectAdminclasssem" resultType="java.util.Map">
		SELECT DISTINCT	SEMESTER as SEMESTER, CONCAT(SEMESTER, "학기") as SEMESTERN
		FROM CLASS
		ORDER BY SEMESTER DESC;
	</select>
	
	
	<select id="SelectAdminClasscourse" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT c.CLASS_TIME_CODE as CLASS_TIME_CODE,
			   a.CLASSROOM_ID as CLASSROOM_ID, 
		       a.CLASS_NAME as CLASS_NAME, 
		       a.PROFESSOR_ID as PROFESSOR_ID, 
		       b.CLASSROOM_NAME as CLASSROOM_NAME, 
		       a.DEPARTMENT_CODE as DEPARTMENT_CODE, 
		       c.TIME_NUMBER as TIME_NUMBER, 
		       c.CLASS_WEEK as CLASS_WEEK,
		       a.CLASS_CODE as CLASS_CODE,
		       p.NAME as PROFESSOR_NAME,
		       a.SEMESTER as SEMESTER,
		       a.CLASS_GRADE as CLASS_GRADE,
		       a.CLASS_START as CLASS_START,
		       a.CLASS_END as CLASS_END,
		       a.CRE_USR as ADMIN_CODE,
		       a.UPD_DTM as REGDATE,
		       0 AS 'CHECK'
		FROM CLASS a
			LEFT JOIN CLASSROOM b
			    ON a.CLASSROOM_ID = b.CLASSROOM_ID
			LEFT JOIN CLASS_TIME c
			    ON a.CLASS_CODE = c.CLASS_CODE
			LEFT JOIN PROFESSOR p
				ON p.PROFESSOR_ID = a.PROFESSOR_ID
		WHERE YEAR(a.CLASS_START)= #{YEAR}
				AND a.SEMESTER = #{SEMESTER};
	</select>

	<select id="SelectAdminclasstime" parameterType="java.util.Map" resultType="Integer">
		SELECT COUNT(CLASS_TIME_CODE)  
		FROM CLASS_TIME
		WHERE CLASS_TIME_CODE = #{CLASS_TIME_CODE}
	</select>
	
	<!-- 하나의 강의에 두개의 강의실을 넣을 수 없도록 설계 -->
	<update id="updateAdminClasscourse" parameterType="java.util.Map">
		UPDATE CLASS
		SET CLASSROOM_ID = #{CLASSROOM_ID}, 
			UPD_DTM = NOW(),
			UPD_USR = #{ADMIN_CODE}
		WHERE CLASS_CODE = #{CLASS_CODE};
	</update>
	
	<insert id="insertAdminClasscourse" parameterType="java.util.Map">
		INSERT INTO CLASS_TIME(
			<if test="CLASS_TIME_CODE != null">
				CLASS_TIME_CODE,
			</if>
			CLASS_CODE, 
			CLASS_WEEK, 
			TIME_NUMBER,
			CRE_DTM,
			CRE_USR
			)
			VALUES (
				<if test="CLASS_TIME_CODE != null">
					#{CLASS_TIME_CODE},
				</if>
				#{CLASS_CODE}, 
				#{CLASS_WEEK}, 
				#{TIME_NUMBER},
				NOW(),
				#{ADMIN_CODE})
	</insert>
	
	<update id="updateAdminClasscourse2" parameterType="java.util.Map">
		UPDATE CLASS_TIME
			SET CLASS_CODE = #{CLASS_CODE},
				CLASS_WEEK = #{CLASS_WEEK},
				TIME_NUMBER = #{TIME_NUMBER},
				UPD_DTM = NOW(),
				UPD_USR = #{ADMIN_CODE}
		WHERE CLASS_TIME_CODE = #{CLASS_TIME_CODE};
	</update>
	
	<delete id="deleteAdminClasscourse" parameterType="java.util.Map">
		DELETE from CLASS_TIME
		WHERE CLASS_TIME_CODE = #{CLASS_TIME_CODE};
	</delete>
	
	<select id="checkAdminclassroom" parameterType="java.util.Map" resultType="Integer">
		SELECT COUNT(CLASSROOM_ID)  
		FROM CLASSROOM
		WHERE CLASSROOM_ID = #{CLASSROOM_ID}
	</select>
	
	<insert id="insertAdminclassroom" parameterType="java.util.Map">
		INSERT INTO CLASSROOM (CLASSROOM_ID, CLASSROOM_NAME, MAX_PEOPLE, CRE_DTM, CRE_USR)
			VALUES(#{CLASSROOM_ID}, #{CLASSROOM_NAME}, #{MAX_PEOPLE}, NOW(), #{ADMIN_CODE})
	</insert>
	
	<update id="updateAdminclassroom" parameterType="java.util.Map">
		UPDATE CLASSROOM SET CLASSROOM_NAME = #{CLASSROOM_NAME}, MAX_PEOPLE = #{MAX_PEOPLE}, UPD_DTM = NOW(), UPD_USR = #{ADMIN_CODE}
		WHERE CLASSROOM_ID = #{CLASSROOM_ID}
	</update>
	
	<delete id="deleteAdminClassroom" parameterType="java.util.Map">
		DELETE FROM CLASSROOM
		WHERE CLASSROOM_ID = #{CLASSROOM_ID};
	</delete>
	
</mapper>