<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ateam.mapper.AdProfessorMapper">

	
	<!-- list grd에 목록 생성 -->
	<select id="selectAdProList" parameterType="java.util.Map" resultType="java.util.Map">
	
		SELECT p.PROFESSOR_ID, p.NAME, p.PHONE, p.EMAIL, p.GENDER, p.ADDRESS, DATE_FORMAT(p.BIRTHDAY, '%Y-%m-%d') AS BIRTHDAY, p.STATUS, p.DEPARTMENT_CODE, p.CRE_USR, p.CRE_DTM, p.UPD_USR, p.UPD_DTM, d.DEPARTMENT_NAME, 0 AS 'CHECK'
		FROM PROFESSOR p
		JOIN DEPARTMENT d
		on p.DEPARTMENT_CODE = d.DEPARTMENT_CODE
		WHERE 1=1
		
		<if test="SEARCH_WORD != null">
			<if test="SEARCH_TYPE == 'ALL'"> 
				AND (p.PROFESSOR_ID LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR p.NAME LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR p.PHONE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR p.EMAIL LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR p.ADDRESS LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR p.STATUS LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR p.GENDER LIKE CONCAT('%', #{SEARCH_WORD}, '%'))
				
			</if>
			<if test="SEARCH_TYPE == 'PROFESSOR_ID'">
				AND p.PROFESSOR_ID LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'NAME'">
				AND p.NAME LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'PHONE'">
				AND p.PHONE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'EMAIL'">
				AND p.EMAIL LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'ADDRESS'">
				AND p.ADDRESS LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'STATUS'">
				AND p.STATUS LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'GENDER'">
				AND p.GENDER LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
		</if>
		<if test="DEPARTMENT_CODE != 0">
			AND p.DEPARTMENT_CODE = #{DEPARTMENT_CODE}
		</if>
	</select>

	<!-- 미등록시 insert문 실행 -->
	<insert id="insertAdPro" parameterType="java.util.Map">
		
		INSERT INTO PROFESSOR(
			PROFESSOR_ID,
			PASSWORD,
			NAME,
			PHONE,
			EMAIL,
			BIRTHDAY,
			GENDER,
			ADDRESS,
			STATUS,
			DEPARTMENT_CODE,
			PHOTO,
			CRE_USR,
			CRE_DTM,
			UPD_USR,
			UPD_DTM,
			ZIPCODE)
					 VALUES(
							#{PROFESSOR_ID},
							SHA2(#{PASSWORD}, 256),
							#{NAME},
							#{PHONE},
							#{EMAIL},
							#{BIRTHDAY},
							#{GENDER},
							#{ADDRESS},
							#{STATUS},
							#{DEPARTMENT_CODE},
							#{PHOTO},
							#{CRE_USR},
							SYSDATE(),
							#{UPD_USR},
							SYSDATE(),
							#{ZIPCODE}
							)
	
	</insert>
	
	<!-- 기등록시 update문 실행 -->
	<update id="updateAdPro" parameterType="java.util.Map">
	
		UPDATE PROFESSOR SET
					PASSWORD = SHA2(#{PASSWORD}, 256),
					NAME = #{NAME},
					PHONE = #{PHONE},
					EMAIL = #{EMAIL},
					BIRTHDAY = #{BIRTHDAY},
					GENDER = #{GENDER},
					ADDRESS = #{ADDRESS},
					STATUS = #{STATUS},
					DEPARTMENT_CODE = #{DEPARTMENT_CODE},
					PHOTO = #{PHOTO},
					UPD_USR = #{UPD_USR},
					UPD_DTM = SYSDATE(),
					ZIPCODE = #{ZIPCODE}
					WHERE 
					PROFESSOR_ID = #{PROFESSOR_ID}
	
	</update>
	
	<!-- 상세보기용 교수정보 select -->
	<select id="selectAdProInfo" parameterType="java.util.Map" resultType="java.util.Map">
	
		SELECT 
        	PROFESSOR_ID,
        	IFNULL(PASSWORD, '') AS PASSWORD,
        	IFNULL(NAME, '') AS NAME,
        	IFNULL(PHONE, '') AS PHONE,
        	IFNULL(EMAIL, '') AS EMAIL,
        	IFNULL(GENDER, '') AS GENDER,
        	IFNULL(ADDRESS, '') AS ADDRESS,
        	IFNULL(BIRTHDAY, '1980-01-01') AS BIRTHDAY,
        	IFNULL(STATUS, '') AS STATUS,
        	IFNULL(DEPARTMENT_CODE, '') AS DEPARTMENT_CODE,
        	IFNULL(PHOTO, '') AS PHOTO,
        	IFNULL(UPD_DTM, '') AS UPD_DTM, 
        	IFNULL(UPD_USR, 'SYSTEM') AS UPD_USR,
        	IFNULL(ZIPCODE, '') AS ZIPCODE
    	FROM PROFESSOR
    	WHERE 1=1
    	AND PROFESSOR_ID = #{ProId}
	
	</select>
	
	<!-- list grd에 체크된 값들 삭제처리 -->
	<delete id="deleteAdPro" parameterType="java.util.Map">
      
      DELETE FROM PROFESSOR
      WHERE PROFESSOR_ID = #{PROFESSOR_ID}
   
   </delete>
   
   <!-- 아이디 중복체크 -->
   <select id="dupCheckId" parameterType="java.util.Map" resultType="INTEGER">
		
		SELECT COUNT(1)
		FROM PROFESSOR
		WHERE PROFESSOR_ID = #{proId}
		
   </select>
   
  	<select id="dupCheckEm" parameterType="java.util.Map" resultType="INTEGER">
  	
  		SELECT COUNT(1)
  		FROM PROFESSOR
  		WHERE EMAIL = #{EMAIL}
  		AND PROFESSOR_ID != #{PROFESSOR_ID}
  		
  	</select>
  	
  	<select id="proLoginCheck" resultType="ateam.dto.ProfessorDTO">
  	
  		SELECT PROFESSOR_ID, 
				NAME,
				PHONE,
				EMAIL,
				BIRTHDAY,
				GENDER,
				ADDRESS,
				STATUS,
				DEPARTMENT_CODE,
				PHOTO,
				ZIPCODE
		FROM PROFESSOR
		WHERE PROFESSOR_ID = #{professorId}
		AND PASSWORD = #{password}
  	
  	</select>
  	
</mapper>