<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ateam.mapper.AdClassInfoMapper">

	<!-- list grd에 목록 생성 -->
	<select id="selectAdClsList" parameterType="java.util.Map" resultType="java.util.Map">
	
		SELECT CLASS_CODE, CLASS_NAME,  DATE_FORMAT(CLASS_START, '%Y%m%d') AS CLASS_START,
			   DATE_FORMAT(CLASS_END, '%Y%m%d') AS CLASS_END, SEMESTER, CLASS_GRADE, DEPARTMENT_CODE, CLASSROOM_ID,
		PROFESSOR_ID, CLASS_TYPE, CLASS_INFO, 0 AS 'CHECK'
		FROM CLASS
		WHERE 1=1
		
		<if test="SEARCH_WORD != null">
			<if test="SEARCH_TYPE == 'ALL'"> 
				AND (CLASS_CODE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR CLASS_NAME LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR CLASS_START LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR CLASS_END LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR SEMESTER LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR CLASS_GRADE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR CLASSROOM_ID LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR PROFESSOR_ID LIKE CONCAT('%', #{SEARCH_WORD}, '%')
				OR CLASS_TYPE LIKE CONCAT('%', #{SEARCH_WORD}, '%'))	
			</if>
			<if test="SEARCH_TYPE == 'CLASS_CODE'">
				AND CLASS_CODE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'CLASS_NAME'">
				AND CLASS_NAME LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'CLASS_START'">
				AND CLASS_START LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'CLASS_END'">
				AND CLASS_END LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'SEMESTER'">
				AND SEMESTER LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'CLASS_GRADE'">
				AND CLASS_GRADE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'CLASSROOM_ID'">
				AND CLASSROOM_ID LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'PROFESSOR_ID'">
				AND PROFESSOR_ID LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
			<if test="SEARCH_TYPE == 'CLASS_TYPE'">
				AND CLASS_TYPE LIKE CONCAT('%', #{SEARCH_WORD}, '%')
			</if>
		</if>
		<if test="DEPARTMENT_CODE != 0">
			AND DEPARTMENT_CODE = #{DEPARTMENT_CODE}
		</if>
	</select>
	
	<delete id="deleteAdClsInfo" parameterType="java.util.Map">
      
      DELETE FROM CLASS
      WHERE CLASS_CODE = #{CLASS_CODE}
      
	</delete>
	
	<select id="selectAdClsInfo" parameterType="java.util.Map" resultType="java.util.Map">
	
		SELECT 
        	c.CLASS_CODE,
        	c.CLASS_NAME,
        	DATE_FORMAT(c.CLASS_START, '%Y%m%d') AS CLASS_START,
        	DATE_FORMAT(c.CLASS_END, '%Y%m%d') AS CLASS_END,
        	c.SEMESTER,
        	c.CLASS_GRADE,
        	c.DEPARTMENT_CODE,
        	c.CLASSROOM_ID,
        	c.PROFESSOR_ID,
        	c.CLASS_INFO,
        	c.CLASS_TYPE,
        	c.UPD_DTM,
        	c.UPD_USR,
        	p.NAME
    	FROM CLASS c
    	JOIN PROFESSOR p
    	on c.PROFESSOR_ID = p.PROFESSOR_ID
    	WHERE 1=1
    	AND CLASS_CODE = #{clsCd}
	
	</select>
	
	<select id="selectProId" parameterType="java.util.Map" resultType="java.util.Map">
	
		SELECT p.PROFESSOR_ID, p.NAME
		FROM PROFESSOR p
			JOIN DEPARTMENT d
			ON p.DEPARTMENT_CODE = d.DEPARTMENT_CODE
		WHERE d.DEPARTMENT_CODE = #{DEPARTMENT_CODE}
			
	</select>
	
	<insert id="insertAdClsInfo" parameterType="java.util.Map">
	
		INSERT INTO CLASS(CLASS_NAME, CLASS_START, CLASS_END, SEMESTER, CLASS_GRADE, DEPARTMENT_CODE,
			PROFESSOR_ID, CLASS_INFO, CLASS_TYPE, CRE_USR, CRE_DTM, UPD_USR, UPD_DTM)
		VALUES(
			#{CLASS_NAME},
			#{CLASS_START},
			#{CLASS_END},
			#{SEMESTER},
			#{CLASS_GRADE},
			#{DEPARTMENT_CODE},
			#{PROFESSOR_ID},
			#{CLASS_INFO},
			#{CLASS_TYPE},
			#{CRE_USR},
			SYSDATE(),
			#{UPD_USR},
			SYSDATE())
			
	</insert>
	
	<update id="updateAdClsInfo" parameterType="java.util.Map">
	
		UPDATE CLASS SET
					CLASS_NAME = #{CLASS_NAME},
					CLASS_START = #{CLASS_START},
					CLASS_END = #{CLASS_END},
					SEMESTER = #{SEMESTER},
					CLASS_GRADE = #{CLASS_GRADE},
					DEPARTMENT_CODE = #{DEPARTMENT_CODE},
					PROFESSOR_ID = #{PROFESSOR_ID},
					DEPARTMENT_CODE = #{DEPARTMENT_CODE},
					CLASS_INFO = #{CLASS_INFO},
					CLASS_TYPE = #{CLASS_TYPE},
					UPD_USR = #{UPD_USR},
					UPD_DTM = SYSDATE()
					WHERE 
					CLASS_CODE = #{CLASS_CODE}
		
	
	</update>
</mapper>